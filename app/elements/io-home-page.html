<!--
Copyright 2016 Google Inc. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/google-youtube/google-youtube.html">

<link rel="import" href="../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html">

<!-- TODO: put back for phase 2-3 when there are tweets -->
<!-- <link rel="import" href="social-poller.html"> -->
<!-- <link rel="import" href="social-post.html"> -->
<link rel="import" href="countdown-timer/countdown-timer.html">
<link rel="import" href="card-video.html">

<link rel="import" href="shared-app-styles.html">
<link rel="import" href="PageBehavior.html">


<dom-module id="io-home-page">
<template>
  <style include="shared-app-styles">
    :host {
      display: block;
    }
  </style>

  <div class="masthead-container" layout horizontal end>
    <div class="masthead-meta">
      <div id="countdown-container" fit>
        <countdown-timer id="ctimer"
            date="[[date]]"
            role="timer"></countdown-timer>
      </div>
    </div>
  </div>

  <!-- <paper-toolbar class="navbar__overlay navbar__overlay--video"
                 aria-hidden$="{{!app.fullscreenVideoActive}}" fit>
    <paper-icon-button icon="io:arrow-back"
        on-tap="closeVideoCard"
        aria-label="Close video"
        tabindex$="[[_enableTabIndex(app.fullscreenVideoActive)]]"></paper-icon-button>
    <span flex>Watch the I/O 2015 Recap</span>
  </paper-toolbar> -->

  <!-- backdrop shouldn't be applied on ios - github.com/Polymer/paper-dialog/issues/16 -->
  <paper-dialog class="video_overlay-dialog"
                entry-animation="scale-up-animation"
                exit-animation="fade-out-animation"
                on-iron-overlay-closed="closeDialogVideo">
    <paper-icon-button icon="io:arrow-back" dialog-dismiss
                       aria-label="Close dialog"></paper-icon-button>
    <template is="dom-if" if="[[app.fullscreenVideoActive]]" restamp>
      <div class="fullvideo__container" fit>
        <google-youtube video-id="OT8wVt1Bt_Y" fit width="100%" height="100%"
            autohide="1" controls="2" modestbranding="1" showinfo="0"
            iv_load_policy="3" rel="0" autoplay="1"></google-youtube>
      </div>
    </template>
  </paper-dialog>

  <div class="active">

    <div class="card__container slide-up">

      <div class="card" layout horizontal wrap  vertical$="{{app.isPhoneSize}}">

        <div class="card-content box card--top-left-clip bg-cyan-300" layout vertical>
          <h3 class="card__title"><p>May 18&#8211;20, 2016</p></h3>
          <h3 class="card__sub-title">
            <a href="https://goo.gl/maps/7hs1NJR3ErG2" target="_blank"
               data-track-link="nav-shoreline-maps-link">
               <span>Shoreline Amphitheatre<br>Mountain View, California</span>
            </a>
          </h3>
          <div layout flex end>
            <div>
              <h5><p>Registration begins March 8. <a href="/io2016/faq">Learn More</a></p></h5>
              <h5 style="font-weight:normal">Google I/O is for developers&#8212;the creative coders who are building what&#8217;s next. Together we&#8217;ll explore the latest in tech, mobile, and beyond.</h5>
            </div>
          </div>
        </div>
        <div class="card-content box card__photo card--top-right-clip" relative>
          <iron-pages id="photo_list" class="card--top-right-clip" on-transitionend="onTransitionEnd" selected="0" fit>
            <img src="/io2016/images/home/cardboard.jpg" class="card--top-right-clip" alt="A man wearing headphones looks through a Google cardboard device" aria-hidden="true">
            <img src="/io2016/images/home/keynote.jpg" class="card--top-right-clip" alt="A woman presents a keynote address on stage at Google I/O" aria-hidden="true">
            <img src="/io2016/images/home/design.jpg" class="card--top-right-clip" alt="An audience sits on bean bag chairs watching a presentation on design" aria-hidden="true">
            <img src="/io2016/images/home/hand.jpg" class="card--top-right-clip" alt="A woman is shown a demonstration of a robotic arm" aria-hidden="true">
            <img src="/io2016/images/home/dj.jpg" class="card--top-right-clip" alt="A D.J. plays turntables in a booth with a large I/O logo" aria-hidden="true">
          </iron-pages>
        </div>

        <div class="card-content box card__video box-full fullbleed typo-white" layout vertical>
          <div class="card-content card__play-button card__photo photo__recap"
               style="height:100%"
               on-tap="openDialogVideo"
               on-keyup="checkOpenDialogVideo"
               data-track-link="home-watch-recap-video"
               role="button"
               tabindex="0"
               flex>
            <h5>Watch the I/O 2015 recap</h5>
          </div>
        </div>

        <div class="card-content box card--bottom-left-clip card--allow-a-wrap fullbleed typo-indigo-400 bg-bluegrey-50-20">

          <!-- <social-poller url="[[resolveUrl('../api/v1/social')]]" posts="{{socialPosts}}"
                         interval="30000"></social-poller>

          <iron-pages id="social_list" selected="0" style="height:100%" layout vertical>
            <template is="dom-repeat" items="[[_limit(socialPosts, 5)]]" as="post">
              <social-post view="card"
                           kind="[[post.kind]]"
                           author="[[post.author]]"
                           url="[[post.url]]"
                           text="[[post.text]]"
                           when="[[post.when]]"
                           layout vertical flex>
              </social-post>
            </template>
          </iron-pages> -->

          <a class="social-link card-content" href="https://twitter.com/sundarpichai/status/686963501219233792" target="_blank">
            <div class="social-card" layout vertical style="height:100%">
              <h2 style="font-weight:normal">I/O coming to the neighborhood where it all started: I/O'16 at Shoreline Amphitheatre in Mountain View, May 18-20. More details soon. #io16</h2>
              <div layout flex end>
                <span>
                  <iron-icon icon="io:post-twitter"></iron-icon>
                  <span class="social-author">Sundar Pichai</span>
                </span>
              </div>
            </div>
          </a>

        </div>
        <div class="card-content box card--bottom-right-clip fullbleed io__hash bg-bluegrey-50-40">
          <template is="dom-if" if="[[app.isDesktopSize]]">
            <card-video id="card-video"
                href="https://twitter.com/search?q=io2016"
                text="Search #io2016 on Twitter"></card-video>
          </template>
        </div>
      </div>
    </div>

  </div>

</template>
<script>
(function () {
  'use strict';

  var _cycleSocialPostsInterval = null;
  var _cyclePhotosInterval = null;
  var SOCIAL_CYCLE = 5000;
  var PHOTOS_CYCLE = 4000;

  Polymer({
    is: 'io-home-page',

    behaviors: [IOBehaviors.PageBehavior],

    properties: {
      /**
       * The target date for I/O to start. Should be specified in ISO 8601
       * format, e.g. `May 18 2016 09:00:00 GMT-0700 (PDT)`.
       */
      date: {
        type: String,
        value: 'May 18 2016 09:00:00 GMT-0700 (PDT)'
      }
    },

    title: 'Google I/O 2016',
    name: 'home',

    attached: function() {
      // Reset template variables for when revisiting the page.
      this.set('app.fullscreenVideoActive', false);
    },

    detached: function() {
      window.clearInterval(_cycleSocialPostsInterval);
      window.clearInterval(_cyclePhotosInterval);
      _cycleSocialPostsInterval = null;
      _cyclePhotosInterval = null;
    },

    onPageTransitionDone: function() {
      this.$.ctimer.start(); // Start countdown.

      //this._cycleSocialPosts(); TODO: add back after phase 1.
      this._cyclePhotos();

      var video = Polymer.dom(this.root).querySelector('card-video');
      if (video) {
        video.src = '/io2016/videos/hashtag-800.mp4'
      }

    },

    // Manage screen reader accessibility for offscreen carousel
    // images
    onTransitionEnd: function(e) {
      e.stopPropagation();
      var photo = Polymer.dom(e).rootTarget;
      if (photo.classList.contains('iron-selected')) {
        photo.setAttribute('aria-hidden', false);
        return;
      }

      photo.setAttribute('aria-hidden', true);
      return;
    },

    _onSetReminder: function(e, detail) {
      e.preventDefault();

      IOWA.Schedule.saveSession('__keynote__', true).then(function() {
        var savedSessions = this.app.savedSessions;
        if (savedSessions.length) {
          IOWA.Schedule.updateSavedSessionsUI(savedSessions);
        }

        IOWA.Schedule.bookmarkSessionNotification(
            true, 'You\'ll be reminded when I/O starts.');
      }.bind(this));
    },

    _cyclePhotos: function() {
      _cycleSocialPostsInterval = window.setInterval(function() {
        this.$.photo_list.selectNext();
      }.bind(this), PHOTOS_CYCLE);
    },

    _cycleSocialPosts: function() {
      _cycleSocialPostsInterval = window.setInterval(function() {
        this.$.social_list.selectNext();
      }.bind(this), SOCIAL_CYCLE);
    }

  });

}());
</script>
</dom-module>
