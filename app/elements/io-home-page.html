<!--
Copyright 2016 Google Inc. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<!-- <link rel="import" href="../bower_components/iron-icon/iron-icon.html"> -->
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../bower_components/google-youtube/google-youtube.html">

<link rel="import" href="social-poller.html">
<link rel="import" href="social-post.html">
<link rel="import" href="countdown-timer/countdown-timer.html">

<link rel="import" href="shared-app-styles.html">
<link rel="import" href="PageBehavior.html">


<dom-module id="io-home-page">
<template>
  <style include="shared-app-styles">
    :host {
      display: block;
    }
  </style>

  <div class="masthead-container" layout horizontal end>
    <div class="masthead-meta">
      <div id="countdown-container" fit>
        <countdown-timer id="ctimer"
            auto-start
            bg-color="#F5F5F5"
            date="[[date]]"
            ease-in-time="490"
            wait-time="100"
            ease-out-time="400"
            value="{{countdownValue}}"
            label="Google I/O"
            role="timer"></countdown-timer>
      </div>
    </div>
  </div>

  <div class="active">

    <div class="card__container slide-up">

      <div class="card" layout horizontal wrap  vertical$="{{app.isPhoneSize}}">

        <!-- <div class="card-content card--top-left-clip box" layout vertical>
          <p>To celebrate our 10th anniversary of developer gatherings, we'll be hosting I/O in our backyard at the Shoreline Amphitheatre in Mountain View, CA.</p>
          <p>Registration opens March 2.</p>
          <a href="https://goo.gl/maps/7hs1NJR3ErG2" target="_blank"
             data-track-link="card-shoreline-maps-link"
             layout horizontal justified flex end>Map the venue
            <iron-icon icon="io:keyboard-arrow-right"></iron-icon>
          </a>
        </div> -->
        <div class="card-content box card--top-left-clip bg-indigo typo-white" layout vertical>
          <h3 class="card__title">May 18-20</h3>
          <h3>
            <a href="https://goo.gl/maps/7hs1NJR3ErG2" target="_blank"
               data-track-link="nav-shoreline-maps-link">
               <span>Shoreline Amphitheatre<br>Mountain View, CA</span>
            </a>
          </h3>
          <div layout flex end>
            <div>
              <h4 class="typo-black">Registration opens March 2.</h4>
              <h4>Google I/O is for developers - the creative coders who are building what's next. Each year, we explore the latest in tech, mobile &amp; beyond.</h4>
            </div>
          </div>
        </div>
        <div class="card-content box card--top-right-clip card__photo photo__people"></div>

        <div class="card-content box full fullbleed typo-white">
          <div class="card-content card__play-button card__photo photo__recap"
               style="height:100%">
            <h4>Watch the I/O 2015 recap</h4>
          </div>
        </div>

        <div class="card-content box card--bottom-left-clip io__hash"
             aria-label="I/O hash tag"></div>
        <div class="card-content box card--bottom-right-clip bg-cyan">

          <social-poller url="[[resolveUrl('../api/v1/social')]]" posts="{{socialPosts}}"
                         interval="30000"></social-poller>

          <iron-pages id="social_list" selected="0" style="height:100%" layout vertical>
            <template is="dom-repeat" items="[[_limit(socialPosts, 5)]]" as="post">
              <social-post view="card"
                           kind="[[post.kind]]"
                           author="[[post.author]]"
                           url="[[post.url]]"
                           text="[[post.text]]"
                           when="[[post.when]]"
                           layout vertical flex>
              </social-post>
            </template>
          </iron-pages>

        </div>
      </div>
    </div>

    <!-- <div class="card__container slide-up-delay">
      <div class="io__hash" aria-label="I/O hash tag"></div>
    </div> -->

  </div>

  <!-- <paper-toolbar class="navbar__overlay navbar__overlay--video"
                 aria-hidden$="{{!app.fullscreenVideoActive}}" fit>
    <paper-icon-button icon="arrow-back"
        on-tap="closeVideoCard"
        aria-label="Close video"
        tabindex="[[_enableTabIndex(app.fullscreenVideoActive)]]"></paper-icon-button>
    <span flex>Watch the 2014 I/O Recap Video</span>
  </paper-toolbar> -->

  <!-- <template is="dom-if" if="{{app.fullscreenVideoActive}}" restamp>
    <div class="fullvideo__container" fit hidden>
      <img src$="[[resolveUrl('./images/home/recap-500@2x.jpg')]]" class="fullvideo_thumbnail" alt="Watch the I/O Recap Video" fit>
      <google-youtube video-id="ksvdvCDO7pA" height="100%" width="100%" fit
                      autohide="1" controls="2" modestbranding="1" showinfo="0"
                      iv_load_policy="3" rel="0" autoplay="1"></google-youtube>
    </div>
  </template> -->

</template>
<script>
(function () {
  'use strict';

  var _cycleInterval = null;
  var SOCIAL_CYCLE = 5000;

  Polymer({
    is: 'io-home-page',

    behaviors: [IOBehaviors.PageBehavior],

    properties: {
      /**
       * The target date for I/O to start. Should be specified in ISO 8601
       * format, e.g. `May 10 2016 09:00:00 GMT-0700 (PDT)`.
       */
      date: {
        type: String,
        value: 'May 10 2016 09:00:00 GMT-0700 (PDT)'
      },

      /*
       * Toggles the save progress bar for being reminded about I/O.
       */
      _ioReminder: {
        type: Boolean,
        value: false
      }
    },

    title: 'Google I/O 2016',
    name: 'home',

    attached: function() {
      // Reset template variables for when revisiting the page.
      this.set('app.fullscreenVideoActive', false);
    },

    detached: function() {
      window.clearInterval(_cycleInterval);
      _cycleInterval = null;
    },

    onPageTransitionDone: function() {
      this.$.ctimer.show();
      this._cycleSocialPosts();
    },

    _onSetReminder: function(e, detail) {
      e.preventDefault();

      this._ioReminder = true;

      IOWA.Schedule.saveSession('__keynote__', true).then(function() {
        this._ioReminder = false;

        var savedSessions = this.app.savedSessions;
        if (savedSessions.length) {
          IOWA.Schedule.updateSavedSessionsUI(savedSessions);
        }

        IOWA.Schedule.bookmarkSessionNotification(
            true, 'You\'ll be reminded when I/O starts.');
      }.bind(this));
    },

    _cycleSocialPosts: function() {
      _cycleInterval = window.setInterval(function() {
        var pages = Polymer.dom(this.root).node.querySelector('#social_list');
        pages.selectNext();
      }, SOCIAL_CYCLE);
    }

  });

}());
</script>
</dom-module>
