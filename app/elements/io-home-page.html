<!--
Copyright 2016 Google Inc. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../bower_components/google-youtube/google-youtube.html">

<link rel="import" href="social-poller.html">
<link rel="import" href="social-post.html">
<link rel="import" href="countdown-timer/countdown-timer.html">

<link rel="import" href="shared-app-styles.html">
<link rel="import" href="PageBehavior.html">


<dom-module id="io-home-page">
<template>
  <style include="shared-app-styles">
    :host {
      display: block;
    }
  </style>

  <div class="masthead-container" layout horizontal end>
    <div class="masthead-meta">
      <div id="countdown-container" fit>
        <countdown-timer id="ctimer"
            auto-start
            bg-color="#F5F5F5"
            date="[[date]]"
            ease-in-time="490"
            wait-time="100"
            ease-out-time="400"
            value="{{countdownValue}}"
            label="Google I/O"
            role="timer"></countdown-timer>
      </div>
    </div>
  </div>

  <div class="active">

    <div class="card__container slide-up">
      <div class="event__meta">
        <span><iron-icon icon="event"></iron-icon> May 18-20</span>
        <span class="event__meta-location">
          <a href="https://goo.gl/maps/7hs1NJR3ErG2" target="_blank"
             data-track-link="nav-shoreline-maps-link">
            <iron-icon icon="io:place"></iron-icon>Shoreline Amphitheatre</a>
        </span>
      </div>

      <div class="card" layout horizontal wrap  vertical$="{{app.isPhoneSize}}">
        <div class="card-content box card--top-left-clip card__photo photo__people"></div>
        <div class="card-content card--top-right-clip box" layout vertical justified>
          <p>To celebrate our 10th anniversary of developer gatherings, we'll be hosting I/O in our backyard at the Shoreline Amphitheatre in Mountain View, CA.</p>
          <p>Registration opens March 2.</p>
          <a href="https://goo.gl/maps/7hs1NJR3ErG2" target="_blank"
             data-track-link="card-shoreline-maps-link"
             layout horizontal justified flex end>Map the venue
            <iron-icon icon="io:keyboard-arrow-right"></iron-icon>
          </a>
        </div>
        <div class="card-content box card--bottom-left-clip bg-indigo typo-white">
          <social-poller url="[[resolveUrl('../api/v1/social')]]" posts="{{socialPosts}}"
                         interval="30000"></social-poller>

          <template is="dom-if" if="[[_showSocialPosts(socialPosts, 3)]]">
            <div layout vertical>
              <template is="dom-repeat" items="{{_limit(socialPosts, 3)}}" as="post">
                <social-post kind="[[post.kind]]"
                             author="[[post.author]]"
                             url="[[post.url]]"
                             text="[[post.text]]"
                             when="[[post.when]]">
                </social-post>
              </template>
            </div>
          </template>
        </div>
        <div class="card-content box card--bottom-right-clip card__play-button card__photo photo__recap">
          <h4 class="typo-white">Watch the I/O 2015 recap</h4>
        </div>
      </div>
    </div>

    <div class="card__container slide-up-delay">
      <div class="io__hash" aria-label="I/O hash tag"></div>
    </div>

  </div>

  <!-- <paper-toolbar class="navbar__overlay navbar__overlay--video"
                 aria-hidden$="{{!app.fullscreenVideoActive}}" fit>
    <paper-icon-button icon="arrow-back"
        on-tap="closeVideoCard"
        aria-label="Close video"
        tabindex="[[_enableTabIndex(app.fullscreenVideoActive)]]"></paper-icon-button>
    <span flex>Watch the 2014 I/O Recap Video</span>
  </paper-toolbar> -->

  <!-- <template is="dom-if" if="{{app.fullscreenVideoActive}}" restamp>
    <div class="fullvideo__container" fit hidden>
      <img src$="[[resolveUrl('./images/home/recap-500@2x.jpg')]]" class="fullvideo_thumbnail" alt="Watch the I/O Recap Video" fit>
      <google-youtube video-id="ksvdvCDO7pA" height="100%" width="100%" fit
                      autohide="1" controls="2" modestbranding="1" showinfo="0"
                      iv_load_policy="3" rel="0" autoplay="1"></google-youtube>
    </div>
  </template> -->

</template>
<script>
(function () {
  'use strict';

  Polymer({
    is: 'io-home-page',

    behaviors: [IOBehaviors.PageBehavior],

    properties: {
      /**
       * The target date for I/O to start. Should be specified in ISO 8601
       * format, e.g. `May 10 2016 09:00:00 GMT-0700 (PDT)`.
       */
      date: {
        type: String,
        value: 'May 10 2016 09:00:00 GMT-0700 (PDT)'
      },

      /*
       * Toggles the save progress bar for being reminded about I/O.
       */
      _ioReminder: {
        type: Boolean,
        value: false
      }
    },

    title: 'Google I/O 2016',
    name: 'home',

    attached: function() {
      // Reset template variables for when revisiting the page.
      this.set('app.fullscreenVideoActive', false);
    },

    onPageTransitionDone: function() {
      this.$.ctimer.show();
    },

    _onSetReminder: function(e, detail) {
      e.preventDefault();

      this._ioReminder = true;

      IOWA.Schedule.saveSession('__keynote__', true).then(function() {
        this._ioReminder = false;

        var savedSessions = this.app.savedSessions;
        if (savedSessions.length) {
          IOWA.Schedule.updateSavedSessionsUI(savedSessions);
        }

        IOWA.Schedule.bookmarkSessionNotification(
            true, 'You\'ll be reminded when I/O starts.');
      }.bind(this));
    },

    _showSocialPosts: function(posts, atLeast) {
      return posts.length >= atLeast;
    }

  });

}());
</script>
</dom-module>
